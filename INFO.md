

## Possible indicators

All of the information regarding indicators can be found here: https:/investopedia.com/
### RSI (Relative Strength Index)
<div>
    <span class="tag red">Momentum oscillator</span>
    <span class="tag blue">Combine</span>
</div>

https://www.investopedia.com/terms/r/rsi.asp
RSI measures the speed and magnitude of a price change to evaluate overvalued or undervalued conditions in the price of that asset. The RSI is displayed as an oscillator (a line graph that moves between two extremes) and can have a reading from 0 to 100. 
The RSI is considered:
- Over<b>bought</b> when above 70 
- Over<b>sold</b> when below 30.

It can also indicate assets that may be primed for a trend reversal or corrective pullback in price. It can signal when to buy or sell an asset.

- Provices signals about bullish or bearish price momentum, often plotted beneath the graph of an asset's price.
- The RSI line crossing  below the overbought line or above the oversold line can be used as a signal to buy or sell an asset.
- RSI works best in trading ranges rather than trending markets.

#### How it works
As a momentum indicator, the relative strength index compares an assets strength on days when prices go up to its strength on days when prices go down. Relating the result of this comparison to price action can give traders an idea of how an asset may perform. The RSI, used in conjuction with other thenical indicators, can help traders make better-informed trading decisions.

#### Calculating the RSI
RSI uses a two-part calculation that starts with the following formula:

$$RSI_{step one} = 100 - \ {\frac{100}{ 1 + \frac{average gain}{average loss}}}$$


The average gain and loss in this calculation is tha average percentage gain or loss during a look-back period. The formula uses a positive value for the average loss. Periods with price increases are counted as zero in the calculations of average loss.
The standard number of periods to calculate the initial RSI value is 14. For example, imagine the market closed higher sever out of the past 14 days with an average gain of 1%. The remaining seven days all closed lower with an average loss of -0.8%. The RSI would be calculated as follows:

#### Risks
Fully relying on RSI would not be good since it doesn'ta take econimic news, earnings and fundamental data into account. It is a good idea to combine it with other indicators. Additionally, RSI can remain overbought or oversold for long periods of time. Usually paired with volume and the overall trend of the asset.


### Accumulation/Distribution indicator
<div>
    <span class="tag red">Oscilator</span>
    <span class="tag blue">Combine</span>
</div>
https://www.investopedia.com/articles/active-trading/031914/understanding-chaikin-oscillator.asp
#### How it works
The A/D indicator is a volume-measurement tool that assesses the cumulative inflow and outflow of money of a given asset. It measures price and colume of tha asset for ascertain wether iti is being accumulated or distributed. It provides insight on the strength of the current trend and can be used to identify potential reversals. If the A/D line is rising, it indicates that the asset is being accumulated. If the A/D line is falling, it indicates that the asset is being distributed. Having a rising asset but a falling A/D line indicates that the asset is being distributed at a faster rate than it is being accumulated. This can be a sign of a potential reversal. It looks at the relation between the value and the volume of the asset. Accumulations refers to the buying level fot that security given a specific period.
Distributuions refers to the selling level for that security given a specific period.


$$Money Flow Multiplier = \frac{(Close - Low) - (High - Close)}{High - Low}$$

$$Money Flow Volume = Money Flow Multiplier \times Volume$$

$$Accumulation/Distribution = \sum_{i=1}^{n} Money Flow Volume$$

### Average True Range

https://www.investopedia.com/terms/a/atr.asp
#### How it works
Measure volatility in terms of pips or movements in price.
Rising ATR means the volatility is increasing. Whilst the falling ATR means the volatility is decreasing. Can be used to know when to exit a trade. If you enter a long buying period and the ATR is rising, you can expect the price to rise more. If you enter a short selling period and the ATR is rising, you can expect the price to fall more. If you enter a long buying period and the ATR is falling, you can expect the price to rise less. If you enter a short selling period and the ATR is falling, you can expect the price to fall less.

This is a subjective measure, meaning that it is open to interpretation. There is no single ATR value that will tell you with any certainty that a trend is about to reverse or not. Instead, ATR eadings should always be compared against earlier readings to get a feel of a trendâ€™s strength or weakness.

#### Formula
$$TR = max[(High - Low), Abs(High - Close_{previous}), Abs(Low - Close_{previous})]$$

$$ATR = (\frac{1}{n}) \sum_{i=1}^{n} TR_{i}$$

### Bollinger Band
https://www.investopedia.com/terms/b/bollingerbands.asp
#### How it works
It is used as an indicator to measure volatility and can also be used to measure if an asset is overbought or oversold. To see if the asset value is oversold or overbought, you can compare the current price to the upper and lower bands. If the price is above the upper band, it is considered overbought. If the price is below the lower band, it is considered oversold. The bands can also be used to identify potential reversals. If the price is above the upper band and the price starts to fall, it can be a sign of a potential reversal. If the price is below the lower band and the price starts to rise, it can be a sign of a potential reversal.

Roughly 90% of the asset price actions occur between the two bands. Any breakout above or below the bands can be considered a major event. The breakout is not a trading signal. Breakouts provice no clue as to the direction and extend of future price movement.

#### Formula
$$Typical Price = \frac{High + Low + Close}{3}$$

$$Upper BollingerBand = Moving Average(Typical Price, periods) + m * Standard Deviation(Typical Price, periods)$$

$$Lower BollingerBand = Moving Average(Typical Price, periods) - m * Standard Deviation(Typical Price, periods)$$


### Moving Average Convergence Divergence (MACD)

https://www.investopedia.com/terms/m/macd.asp
#### How it works
MACD is a trend-following momentum indicator that shows the relationship between the two moving averages of a security's price. The MACD is calculated by subtracting th 26-period exponential moving average (EMA) from the 12-period EMA, these periods can be adjusted but these are the commonly used values.

An exponential moving average (EMA) is a type of moving average (MA) that places a greater weight and significance on the most recent data points.

MACD is a lagging indicator. After all, all the data used in MACD is based on the historical price action of the stock. Since it is based on historical data, it must necessarily "lag" in price. However, some traders use MACD histograms to predict when a change in trend will occur. For these traders, this aspect of the MACD might be viewed as a leading indicator for future trend changes.

#### Formula
$$MACD = EMA_{12} - EMA_{26}$$



### Money Flow Index (MFI)

https://www.investopedia.com/terms/m/mfi.asp
#### How it works
It is a technical indicator that generates overbought or oversold signals. It incorporates both price and volume data, as opposed to just price. For this reason, some analysts call MFI the volume-weighted RSI.

An MSI reading abond 80 is considered overbought and and MFI reading below 20 is considered oversold, although levels of 90 and 10 are also often used as thresholds.

A divergence between the indicator and price is noteworthy. For example, if the indicator is rising while the price is falling or flat. The price could start rising.

#### Formula
$$Money Flow Index = 100 - \frac{100}{1 + Money Flow Ratio}$$
$$Money Flow Ratio = \frac{14 Period Positive Money Flow}{14 Period Negative Money Flow}$$
$$Raw Money Flow = Typical Price \times Volume$$
$$Typical Price = \frac{High + Low + Close}{3}$$

### Parabolic SAR indicator (PSAR)

https://www.investopedia.com/terms/p/parabolicindicator.asp
#### How it works
The Parabolic SAR indicator, is used by traders to determine trend direction and portential reversal price. The indicator uses a trailing stop and reverse method called Stop And Reverse (SAR), to identify suitable exit and entry points. Traders also refer to the indicator as the parabolic stop and reverse, parabolic SAR, or PSAR.

The PSAR indicator appears on a chart as a series of dots, either above or below and asset's price, depending on the direction the price is moving. A dot is placed below the price when it is trending upward, and above the price when it is trending downward.

- Used to spot trend and potential reversals
- Utilizes a system of dots superimposed onto a price chart
- A reversal occurs when these dots flip, but a reversal signal in the SAR does not necessarily mean a reversal in the price. A PSAR only means that the price and indicator have crossed.

#### Formula
$$RisingPSAR = PSAR_{previous} + AF$$
$$FallingPSAR = PSAR_{previous} - AF$$

##### Where 
- AF = Acceleration Factor (starts with 0.02 and increases by 0.02 each time the SAR changes direction, up to a maximum of 0.2)
- EP = Extreme Point (the highest high for a long position, or the lowest low for a short position)


### Tripple Exponential Moving Average (TEMA)

https://www.investopedia.com/terms/t/triple-exponential-moving-average.asp
#### How it works
The TEMA was designed to smooth price fluctuations, thereby making it easier to identify trends without the lag associated with traditional moving averages. It does this by taking multiple EMAs of the original EMA and subtracting out some of the lag.
The TEMA is used like other MAs. It can help identify trend direction, signal potential short-term trend changes or pullbacks, and provice support or resistance. The TEMA can be compared to the double exponential moving average (DEMA).

#### Formula
$$TEMA = (3 * EMA_{1}) - (3 * EMA_{2}) + EMA_{3}$$

##### Where
- EMA_{1} = Exponential Moving Average of the price
- EMA_{2} = Exponential Moving Average of EMA_{1}
- EMAS_{3} = Exponential Moving Average of EMA_{2}



## Progress

### Preprocessing
The first week I was mostly doing preprocessing in C. Making this in a faster language was necessary for speed, doing this in python proved to be very slow. 
The data candle data that looks like this:

| Index | event_time    | open       | close      | high       | low        | volume   |
| ----- | ------------- | ---------- | ---------- | ---------- | ---------- | -------- |
| 0     | 1643214300000 | 0.05606000 | 0.05611000 | 0.05611000 | 0.05605000 | 213878.1 |
| 1     | 1643214360000 | 0.05612000 | 0.05617000 | 0.05619000 | 0.05608000 | 242867.6 |

Using this data I could calculate some indicators:
- Relative Strength Index (RSI)
- Accumulation/Distribution Oscilator (ADOSC)
- Average True Range (ATR)
- Bollinger Bands (BB)
- Moving Average Convergence Divergence (MACD)
- Money Flow Index (MFI)
- Parabolic SAR indicator (PSAR)
- Tripple Exponential Moving Average (TEMA)

After adding the indicators I normalized all the data. Normalization is a technique often applied as part of data preprocessing for machine learning. The goal of normalization is to change the values of numeric columns in the dataset to use a common scale, without distorting differences in the ranges of values or losing information. 

### Creating my environment
Creating a new environment is very hard since you have to get the rewards exactly right for it to work properly. This is a huge pitfall for me. 
Since the data is imbalanced (there is more off the class `hold` than there is `buy` or `sell`) I had to make sure that the model buys and sells at exactly the right time. 
The model was always overfitting to one class, which was the `hold` class. But eventually I was training my model and saw that it was actually learning something: Not selling multiple times after eachother which is bad since you can't sell after you already sold everything. This also forced the model to work in pairs (`buy` and `sell`). Also, it started to understand the `buy` signal. It ofter decides to `buy`  in a valley.  
![[alternating_buy_sell.png]]
The environment is far from ideal and could still use a lot of work.
### Model

## Why am I using Reinforcement Learning?

### Sequence of decisions
Using standard supervised learning techniques limit the AI in the sense that it will not be able to make multiple decisions that impact eachother. For example, in order for my model to be able to make profits, the model has to sell. But without buying any crypto stock, you can't make a profit. So making profits is based on a sequence of actions or decisions. 

### Outperforming existing methods
Using Reinforment Learning makes it possible to outperform any existing methods as it can learn more from the environment itself, as opposed to only the methods applied during training in supervised learning.

This is especially usefull since I only have limited knowledge of trading crypto currencies and don't have a lot of experience. We could still use supervised learning to make the model know the environment faster, replacing the long and tedious exploration of the environment. Ofcourse this can only be done for a small portion of the training, since it would remove the benefit of reinforcement learning.

While supervised learning is almost only pre-programmed knowledge, Reinforcement Learning methods also require some existing knowledge which subsequently makes the system less autonomous [2, p. 274], but increases the chances of the agent finding the optimal policy. 

### Rewards
I chose to work with more local reinforcement signals over a reward signal at the end of a sequence. This should significantly increase the speed of learning [2, p. 275]

## Why am I using a LSTM model?
https://link.springer.com/content/pdf/10.1007/11550907.pdf?pdf=button
https://www.sciencedirect.com/science/article/abs/pii/S0957417420303055
### Previous models RNN architectures
In the past there have been numerous RNN architectures that had some error when it comes to data in the past. LSTM solves this issue with backpropagation where the model can determine if data should be memorized or forgotten.
This makes LSTM a great solution to time series data, since experiences in the past very often have a large impact on the prediction or outcome.

Research found that RNNs have long time lags were inaccessible to existing architectures, because backgpropageted error eiter blows up or decays exponentially [3, p. 799-800].

A LSTM model is also capable of using an entire sequence of data as input instead of only the one sample. Which is an ideal for processing and prediction data.

![[LSTM_structure.png]]

## Why am I using Deep Reinforcement Learning?

### Infinite states
Crypto currency trading has a lot of data, which is why it also involves using a lot of states. Having many states will result in greater difficulty for agents without a neural network, since I cannot save all the states at once in memory. 

## Sources

| Index | Source                                                                                                                                                                                                                                                                                                                                                                                                 |
| ----- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1     | Rui Nian, Jinfeng Liu, Biao Huang, A review On reinforcement learning: Introduction and applications in industrial process control, Computers & Chemical Engineering, Volume 139, 2020, 106886, ISSN 0098-1354, https://doi.org/10.1016/j.compchemeng.2020.106886.                                                                                                                                     |
| 2     | L. P. Kaelbling, M. L. Littman, A. W. Moore (1996). Reinforcement Learning: A Survey, Volume 4, 1996 https://doi.org/10.1613/jair.301                                                                                                                                                                                                                                                                  |
| 3     | Graves, A., FernÃ¡ndez, S., Schmidhuber, J. (2005). Bidirectional LSTM Networks for Improved Phoneme Classification and Recognition. In: Duch, W., Kacprzyk, J., Oja, E., ZadroÅ¼ny, S. (eds) Artificial Neural Networks: Formal Models and Their Applications â€“ ICANN 2005. ICANN 2005. Lecture Notes in Computer Science, vol 3697. Springer, Berlin, Heidelberg. https://doi.org/10.1007/11550907_126 |


#### What to say 

Hallo iedereen, ik ga jullie vandaag vertellen wat ik de afgelopen maand gedaan heb.
Eerst en vooral wil ik jullie herinneren aan mijn onderzoeksvraag: Welke factoren zijn belangerijk bij het voorspellen van de cryptomarkt a.d.h.v een LSTM model? Ik heb niet alleen gebruik gemaakt van een LSTM model maar ook van reinforcement learning, waarbij het model in een omgeving gezet wordt en positieve of negatieve feedback krijgt na elke actie in de omgeving. 
Mijn doel was eigelijk om een AI model te maken waar dat mensen hun spaargeld kunnen in steken en het model voor het laat handelen.

Nu, Tot waar ben ik geraakt en wat heb ik al ondervonden? 
Spoiler alert: Het model werkt niet zoals gehoopt, maar ik heb vanalles geleerd onderweg en dat ga ik jullie nu vertellen.
De eerste week heb ik me vooral bezig gehouden met het verwerken van de data dat ik gehaald heb via de API van Binance, een cryptocurrency platform waar je munten kan traden. Ten eerste heb ik de data verwerkt met een C-script en heb ik gebruik gemaakt van TA-Lib (een library voor het verwerken van financiele data) die namelijk ook beschikbaar is in python maar het script was veel sneller in C (zeker het schrijven en lezen van files). 
Met dat script heb ik 2 dingen gedaan:
- een aantal indicatoren berekenen waarmee je de markt kan analiseren.
- normaliseren van de data
	- Dit heb ik gedaan zodat alle data op de zelfde schaal staat waardoor het model sneller kan trainen, dit is vooral belangrijk wanneer je met meerdere munten werkt dit kan een uitbreiding zijn in de toekomst.

Na het verwerken van de data kon ik beginnen met een omgeving te programmeren waarin mijn model kan leren omgaan met de crypto munten. Omdat er geen bestaande crypto omgevingen zijn, heb ik zelf een moeten maken. Dit heeft me 1,5 week gekost aangezien dit uitdagender was dan ik had verwacht.
Het is me initieel wel gelukt om deze omgeving te maken, het enige wat nog moeilijk was en nog steeds is, is het bereken van de rewards of de beloningen voor de acties dat het model maakt. Na die 1,5 week had ik een omgeving waarmee ik verder kon. 

Het finetunen verliep heel moeizaam een traag, waardoor ik specifieker ben gaan zoeken naar wat er mis was. Er waren 2 dingen fout:
- Het downloaden van de data was niet perfect sequentieel gebeurt door een programma fout van mij. Hierdoor was mijn data niet op volgorde en had ik dubbele data
- Mijn data verwerkings script had ook een programmeer fout en gaf me incorrecte data.
![[bad_preprocessing.png]]![[better_preprocessing.png]]
Ondertussen was het eind januari en had ik nog altijd geen model dat werkte zoals gehoopt. Dus ben ik verder gaan zoeken. 

Als volgt ben ik die zelfde dag (omdat de data nu wel juist is) nog op een ander probleem gebotst namelijk: Mijn berekeningen met de geld balans en aantal munten waren verkeerd. Dit resulteerde dus ook in slechte resultaten. Maar ik heb dit probleem gevonden en opgelost. Aangezien we al zo laat in het process zaten op dit punt, heb ik mijn model hierna niet meer verder kunnen finetunen.

Dit is de huidige stand van zaken van mijn AI model.
![[alternating_buy_sell.png]]
Een model dat precies op random momenten koopt en verkoop maar dat is natuurlijk niet ideaal maar wel al veel beter dan een model dat altijd maar 1 actie kan doen. In dit voorbeeld kiest hij alleen maar acties uit de klasse `hold` 
![[Results/2023-01-27_121317/images/prediction_model_80.h5.png]]

Nu waarom heb ik nu eigenlijk voor Deep Reinforcement Learning met een LSTM model gekozen? 

Eerst had ik gekozen voor enkel een LSTM model omdat de crypto markt bestaat uit Time-Series data en LSTM bekend staat voor zijn onthoud vermogen omdat deze bij elke stap gaat bepalen of de data relevant is voor later of vergeten mag worden.

Ik heb dan ook voor reinforcement learning gekozen voor 3 grote redenen:
- Het voorspellen van een volgorde van acties dat bij supervised learning veel moeilijker is.
> Bij het voorspellen welke acties moeten genomen worden moet je bij het traden van crypto munten altijd rekening houden met een volgorde van acties. Want om winst te maken bij het verkopen moet je rekening houden met wanneer je gekocht hebt en wanneer je gewacht hebt.
- Het model is niet beperkt tot standaard trading strategieen.
>Bij supervised learning zal het model zich enkel richten naar de trading strategie die de programmeur heeft opgelegd. Bij reinforcement learning echter leert het model zelf van zijn omgeving en vind eigen strategieen die de programmeur niet per se heeft opgelegd. 
>Een ander voorbeeld is standaard Q-learning maar ook dit is niet efficient want bij dit algoritme worden de stappen bijgehouden. Maar aangezien de cryptomarkt eigenlijk nooit het zelfde is, is dit geen goed algoritme om in deze situatie te gebruiken. 
- Mijn eigen beperkte kennis van crypto
>Het feit dat het model zelf verder kan leren maakt dat het model niet beperkt is tot aan mijn kennis van de crypto markt. 

Dit is de reden waarom ik voor deze combinatie Reinforcemen Learning met LSTM gekozen heb.

Ik heb alle gebruikte informatie over LSTM modellen vooral uit de les gehaald alsook uit een boek:Â "Artificial Neural Networks: Formal Models and Their Applications" uit 2005 wat eigenlijk een verzameling is van Papers over Machine Learning Algoritmes en soorten AI modellen.

Mijn keuze voor Reinforcement Learning te gebruiken heb ik vooral gehaald uit mijn lessen, maar ook uit 2 papers: "Reinforcement Learning: A Survey" van L. P. Kaelbling, M. L. Littman en A. W. Moore uit 1996 En ook "A review On reinforcement learning: introduction and applications in industrial process control, Computer & Chemical Engineering" van Rui Nian, Jinfeng Liu en Biao Huang, waarbij beide Reinforcement Learning onder de loep nemen.

Conclusie:
Op dit moment heb ik nog geen antwoord op mijn onderzoeksvraag, daarintegen heb ik wel een basis gelegd waarop ik kan verder bouwen. Mijn onderzoeksvragen zijn gefocust op factoren van de crypto markt, maar ik heb daarvoor een goed werkend AI model nodig.
In de toekomst (eind Juni) denk ik hier wel antwoorden op te kunnen vinden door alles wat ik onderweg wel al geleerd heb. 
Dankuwel voor jullie aandacht, ik beantwoord graag nog jullie vragen.



- Intro
- Herinneren onderzoeksvraag: welke factoren zijn belangerijk bij het voorspellen van de cryptomarkt a.d.h.v. LSTM model?
- Ook Reinforcement learning: model, omgeving, feedback.
- Doel: Model voor extra geld en autonoom traden
- Wat heb ik al ondervonden?
- Spoiler alert: model werkt niet maar wel vanalles geleerd
- Eerste week: verzamelen van data
- API van Binance
- Verwerkt via C-script
- TA-Lib ook in python maar C sneller
- 2 dingen gedaan
- Indicatoren berekenen voor markt analiseren
- Normaliseren van data
	- Data zelfde schaal zetten
	- snellere training
	- generaliseren over verschillende munten
- Na verwerken, beginnen aan omgeving
- Bestaan geen -> zelf maken
- 1.5 gekost -> uitdagender dan verwacht
- Gelukt om omgeving te maken
- Enige moeilijkheid was rewards berekenen
- Finetunen -> moeizaam en traag 
- Specifieker gaan zoeken.
- 2 dingen fout:
	- Download niet sequentieel -> overlapping en dubbele data
	- data verwerking was incorrect.
	- > Toon de Fotos
- Ondertussen eind januari en nog altijd geen werkend model
- Zelfde dag op probleem gebotst
- Berekeningen geld balans en aantal munten fout -> slechte resultaten
- Zo laat in process -> model niet verder kunnen finetunen
- > Toon huidige stand van zaken.
- Wel random acties maar beter dan 1 klasse
- > Toon oude stand van zaken
- Waarom DRL met LSTM?
- LSTM model
	- Crypto -> time-series
	- LSTM bekend voor vermogen om te onthouden
	- Elke stap checken
		- onthouden
		- vergeten
- Reinforcement Learning
- 3 Grote redenen
	- Voorspellen van een volgorde van acties
	- Beperkt, standaard trading strategieen
		- Supervised learning -> programmeur opgelegd
		- Reinforcement -> leert meer dan wat opgelegd
		- Q-Learning -> Elke stap bijhouden in tabel
			- nooit 2 keer zelfde actie
	- Mijn beperkte kennis
		- Model kan meer leren dan wat ik opleg
- Dit is reden waarom deze combinatie
- LSTM: informatie uit lessen alsook boek 
	- Artificial Neural Networks: Formal Models and Their Applications
		- 2005 
		- Verzamelijk van papers over ML en AI
- RL: informatie uit lessen en 2 papers:
	- Reinforcement Learning: A Survey
		- 1996
	- A review on reinforcement leanring: introduction and applications in industrial process controll, computer & chemical engineering
	- Beide RL onder loep
- Conclusie:
	- Nog geen antwoord op onderzoeksvraag
	- daarintegen basis gelegd -> verder bouwen
	- Vraag gefocussed op factoren crypto-markt
		- Goed werkend model nodig
	- Toekomst vraag wel beantwoorden door alles wat ik geleerd heb
- Vragen?